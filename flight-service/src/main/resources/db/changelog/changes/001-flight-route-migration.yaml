databaseChangeLog:
  - changeSet:
      id: 001-add-route-id-to-flights
      author: system
      comment: "Add route_id column to flights table"
      changes:
        - addColumn:
            tableName: flights
            columns:
              - column:
                  name: route_id
                  type: bigint
                  constraints:
                    nullable: true

  - changeSet:
      id: 001-add-route-id-index
      author: system
      comment: "Add index for route_id for performance"
      changes:
        - createIndex:
            tableName: flights
            indexName: idx_flights_route_id
            columns:
              - column:
                  name: route_id

  - changeSet:
      id: 001-update-flight-indexes
      author: system
      comment: "Update flight indexes to include route_id"
      changes:
        - createIndex:
            tableName: flights
            indexName: idx_flights_route_date
            columns:
              - column:
                  name: route_id
              - column:
                  name: flight_date

  - changeSet:
      id: 001-create-flight-route-summary-view
      author: system
      comment: "Create view for flight summary with route info"
      changes:
        - createView:
            viewName: flight_route_summary
            replaceIfExists: true
            selectQuery: >
              SELECT 
                f.id as flight_id,
                f.flight_number,
                f.route_id,
                f.flight_date,
                f.scheduled_departure,
                f.scheduled_arrival,
                f.status,
                f.origin_airport_id,
                f.destination_airport_id,
                f.active,
                f.created_at,
                f.updated_at
              FROM flights f
              WHERE f.active = 1

  - changeSet:
      id: 001-add-migration-status-table
      author: system
      comment: "Create table to track route migration status"
      changes:
        - createTable:
            tableName: flight_route_migration_status
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: total_flights
                  type: bigint
                  defaultValue: 0
              - column:
                  name: migrated_flights
                  type: bigint
                  defaultValue: 0
              - column:
                  name: migration_started_at
                  type: timestamp
              - column:
                  name: migration_completed_at
                  type: timestamp
              - column:
                  name: migration_status
                  type: varchar(50)
                  defaultValue: 'PENDING'
              - column:
                  name: created_at
                  type: timestamp
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: updated_at
                  type: timestamp
                  defaultValueComputed: CURRENT_TIMESTAMP